{% extends "base.html" %} {% block title %}Friends â€“ Soul Maps{% endblock %} {%
block content %}
<div class="home-container">
  <h2>Friends</h2>

  <!-- Friend Search Section -->
  <div class="friend-search-container mb-4">
    <input
      type="text"
      id="friend-search-input"
      class="friend-search-input"
      placeholder="Enter Username"
      onkeyup="searchFriends()"
    />
    <button class="btn btn-primary" onclick="submitFriendSearch()">
      Search
    </button>
  </div>

  <!-- Friends List -->
  <div class="friends-page">
    <div class="friends-section">
      <h3>Your Friends</h3>
      <div class="friends-list">
        {% for friend in friends %}
        <div class="friend-card">
          <img
            src="{{ url_for('static', filename='media/' + friend.profile_picture) }}"
            alt="{{ friend.name }}"
            class="friend-pfp"
            onerror="this.onerror=null;this.src='{{ url_for('static', filename='media/user.png') }}';"
          />
          <div class="friend-name">{{ friend.name }}</div>
        </div>
        {% else %}
        <p>You have no friends yet ðŸ˜¢</p>
        {% endfor %}
      </div>
    </div>

    <!-- Recommended Friends -->
    <div class="recommended-section">
      <h3>Recommended Connections</h3>
      <div class="friends-list">
        {% for person in recommended[:4] %}
        <div class="friend-card">
          <img
            src="{{ url_for('static', filename='media/' + person.profile_picture) }}"
            alt="{{ person.name }}"
            class="friend-pfp"
            onerror="this.onerror=null;this.src='{{ url_for('static', filename='media/user.png') }}';"
          />
          <div class="friend-name">{{ person.name }}</div>
          <form
            method="POST"
            action="{{ url_for('main.send_friend_request', receiver_id=person.id) }}"
          >
            <button type="submit" class="friends-submit">Add</button>
          </form>
        </div>
        {% else %}
        <p>No more users to recommend!</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- SHARE MEDIA SECTION -->
  <div class="share-section mb-4 p-3 border rounded">
    <h4>Share Media with a Friend</h4>
    <form
      method="post"
      action="{{ url_for('main.share_media') }}"
      class="d-flex gap-2 align-items-center"
    >
      <select name="media_id" class="form-select w-50" required>
        <option value="" disabled selected>Choose media...</option>
        {% for m in user_media %}
        <option value="{{ m.id }}">
          {{ m.media_type|capitalize }} â€“ {{ m.title.replace(' (shared)', '') }}
        </option>
        {% endfor %}
      </select>
      <select name="friend_id" class="form-select w-50" required>
        <option value="" disabled selected>Choose friend...</option>
        {% for f in friends %}
        <option value="{{ f.id }}">{{ f.name }}</option>
        {% endfor %}
      </select>
      <button class="btn btn-success">Share</button>
    </form>
  </div>
</div>

<script>
  function submitFriendSearch() {
    const query = document.getElementById("friend-search-input").value;
    if (query.trim() !== "") {
      window.location.href = "/search?query=" + encodeURIComponent(query);
    }
  }
</script>
{% endblock %}
