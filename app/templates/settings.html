{% extends "base.html" %} {% block title %}Settings – Soul Maps{% endblock %} {%
block content %}
<div class="settings-page">
  <!-- Sidebar -->
  <div class="settings-sidebar">
    <h2>Settings</h2>
    <ul>
      <li onclick="showSection('account')"><b>Account Settings</b></li>
      <li onclick="showSection('privacy')"><b>Privacy Settings</b></li>
      <li onclick="showSection('map')"><b>Map Customization</b></li>
      <li onclick="showSection('notifications')"><b>Notifications</b></li>
      <li onclick="showSection('connections')"><b>Connections & Social</b></li>
      <li onclick="showSection('media')"><b>Media Sources Management</b></li>
      <li onclick="showSection('about')"><b>About / Help / Legal</b></li>
    </ul>
    <button class="logout-button" onclick="confirmLogout()">Log Out</button>
  </div>

  <!-- Main Content -->
  <div class="settings-content">
    <div id="account" class="settings-section">
      <h2>Account Settings</h2>

      <!-- Current User Info Display -->
      <div class="current-user-info">
        <h3>Current Account Info</h3>
        <p><strong>Username:</strong> {{ user.name }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
      </div>

      <!-- Username Update Form with Password Verification -->
      <form
        method="POST"
        action="{{ url_for('main.update_username') }}"
        class="settings-form"
      >
        <label for="username">Change Username</label>
        <input
          type="text"
          id="username"
          name="username"
          placeholder="Enter new username"
          required
        />
        <input
          type="password"
          name="password"
          placeholder="Enter your password"
          required
        />
        <button type="submit" class="btn update-btn">Update Username</button>
      </form>

      <!-- Email Update Form with Password Verification -->
      <form
        method="POST"
        action="{{ url_for('main.update_email') }}"
        class="settings-form"
      >
        <label for="email">Change Email</label>
        <input
          type="email"
          id="email"
          name="email"
          placeholder="Enter new email"
          required
        />
        <input
          type="password"
          name="password"
          placeholder="Enter your password"
          required
        />
        <button type="submit" class="btn update-btn">Update Email</button>
      </form>

      <!-- Password Update Form with Password Verification -->
      <form
        method="POST"
        action="{{ url_for('main.update_password') }}"
        class="settings-form"
        onsubmit="return checkPasswordMatch();"
      >
        <label for="current_password">Current Password</label>
        <input
          type="password"
          id="current_password"
          name="current_password"
          placeholder="Enter current password"
          required
        />

        <label for="new_password">New Password</label>
        <input
          type="password"
          id="new_password"
          name="new_password"
          placeholder="Enter new password"
          required
        />

        <label for="confirm_password">Confirm New Password</label>
        <input
          type="password"
          id="confirm_password"
          name="confirm_password"
          placeholder="Re-enter new password"
          required
        />

        <button type="submit" class="btn update-btn">Update Password</button>
      </form>

      <!-- Account Deletion Form -->
      <form
        method="POST"
        action="{{ url_for('main.delete_account') }}"
        class="settings-form"
        onsubmit="return confirmAccountDeletion();"
      >
        <label for="delete_password"
          >Enter Password to Confirm Account Deletion</label
        >
        <input
          type="password"
          id="delete_password"
          name="delete_password"
          placeholder="Enter your password"
          required
        />
        <button type="submit" class="btn delete-btn">
          Permanently Delete Account
        </button>
      </form>

      <div id="privacy" class="settings-section hidden">
        <h2>Privacy Settings</h2>
        <ul>
          <li>Who can view my map?</li>
          <li>Who can request to connect?</li>
          <li>Hide specific media types</li>
          <li>Hide specific items manually</li>
        </ul>
      </div>

      <div id="map" class="settings-section hidden">
        <h2>Map Customization</h2>
        <ul>
          <li>Choose map style</li>
          <li>Color themes</li>
          <li>Media type focus</li>
          <li>Public vs Private nodes</li>
        </ul>
      </div>

      <div id="notifications" class="settings-section hidden">
        <h2>Notifications</h2>
        <ul>
          <li>New connection requests</li>
          <li>Updates about shared media</li>
          <li>Suggestions</li>
          <li>Toggle email vs push notifications</li>
        </ul>
      </div>

      <div id="connections" class="settings-section hidden">
        <h2>Connections & Social</h2>
        <ul>
          <li>Manage friend requests</li>
          <li>Blocked users list</li>
          <li>Connection history</li>
          <li>Invite friends</li>
        </ul>
      </div>

      <div id="media" class="settings-section hidden">
        <h2>Media Sources Management</h2>
        <ul>
          <li>Connected apps</li>
          <li>Re-sync media libraries</li>
          <li>Disconnect a service</li>
          <li>Set primary media source</li>
        </ul>
      </div>

      <div id="about" class="settings-section hidden">
        <h2>About / Help / Legal</h2>
        <ul>
          <li>
            <b>App Version Info</b><br />
            <em>Version: 1.3.2</em> (Build 2025.05.07)<br />
            Release Date: May 7, 2025<br />
            Changelog:
            <ul>
              <li>Improved user interface and design consistency</li>
              <li>Added new social sharing features</li>
              <li>Enhanced map customization options</li>
              <li>Fixed known bugs and improved performance</li>
            </ul>
          </li>
          <li>
            <b>Terms of Service</b><br />
            Effective Date: May 1, 2025<br />
            Summary:
            <ul>
              <li>
                Use of the app is subject to the terms and conditions outlined.
              </li>
              <li>
                Users are responsible for maintaining the security of their
                accounts.
              </li>
              <li>The app may collect and use data to improve services.</li>
              <li>Misuse of the platform may result in account suspension.</li>
              <li>Full terms available <a href="#">here</a>.</li>
            </ul>
          </li>
          <li>
            <b>Privacy Policy</b><br />
            Effective Date: May 1, 2025<br />
            Summary:
            <ul>
              <li>
                We respect your privacy and prioritize the security of your
                personal data.
              </li>
              <li>
                We do not share or sell your information to third parties.
              </li>
              <li>Data collected is used solely to enhance your experience.</li>
              <li>You can request data deletion at any time.</li>
              <li>Full policy available <a href="#">here</a>.</li>
            </ul>
          </li>
          <li>
            <b>Contact Support</b><br />
            Email: support@soulmaps.app<br />
            Help Center: Visit our <a href="#">Help Center</a> for FAQs and
            guides
          </li>
          <li>
            <b>Submit Feedback / Report a Bug</b><br />
            Feedback Form: Share your thoughts or report issues
            <a href="#">here</a>.<br />
            Community Forum: Join our user community <a href="#">here</a>.<br />
            Bug Bounty: Earn rewards for reporting critical bugs.
          </li>
        </ul>
      </div>
    </div>
  </div>
  <script>
    function showSection(sectionId) {
      // Hide all sections
      const sections = document.querySelectorAll(".settings-section");
      sections.forEach((section) => section.classList.add("hidden"));

      // Show the selected section
      document.getElementById(sectionId).classList.remove("hidden");

      // Remove active class from all sidebar links
      const links = document.querySelectorAll(".settings-sidebar ul li");
      links.forEach((link) => link.classList.remove("active"));

      // Add active class to the clicked link
      const activeLink = Array.from(links).find((link) =>
        link.innerText.includes(sectionId.replace(/_/g, " "))
      );
      if (activeLink) {
        activeLink.classList.add("active");
      }
    }

    // Show the default section (Account Settings) on load
    document.addEventListener("DOMContentLoaded", () => {
      showSection("account");
    });

    function confirmLogout() {
      const confirmAction = confirm("Are you sure you want to log out?");
      if (confirmAction) {
        window.location.href = "{{ url_for('main.logout') }}"; // ✅ uses Flask logout route
      }
    }
    function checkPasswordMatch() {
      const newPassword = document.getElementById("new_password").value;
      const confirmPassword = document.getElementById("confirm_password").value;

      if (newPassword !== confirmPassword) {
        showPopup("Passwords do not match. Please try again.", "error");
        return false;
      }

      return true;
    }

    function confirmAccountDeletion() {
      const password = document.getElementById("delete_password").value.trim();

      if (!password) {
        showPopup(
          "Please enter your password to confirm account deletion.",
          "error"
        );
        return false;
      }

      const confirmAction = confirm(
        "Are you sure you want to permanently delete your account? This action cannot be undone."
      );
      return confirmAction;
    }
  </script>
  {% endblock %}
</div>
