<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Soul Maps{% endblock %}</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/png"
      href="{{ url_for('static', filename='media/SoulMapsIcon.png') }}"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  </head>
  <body
    class="{% if hide_navbar and not is_welcome %}center-page{% endif %} {% if is_welcome %}welcome{% endif %}"
  >
    <!-- Hides Navbar in welcome, login and signup page -->
    {% if not hide_navbar %} {% include "navbar.html" %} {% endif %}

    <!-- Global Flash Messages -->
    <div id="global-flash-messages"></div>

    {% block content %}
    <!-- Page-specific content goes here -->
    {% endblock %}

    <script>
      // Flash message function
        function showPopup(message, type = "success") {
            const popup = document.createElement("div");
            popup.classList.add("popup-message", type);
            popup.textContent = message;
            document.body.appendChild(popup);

            setTimeout(() => {
                popup.classList.add("hide");
                setTimeout(() => popup.remove(), 500);
            }, 3000);
        }

        document.addEventListener("DOMContentLoaded", () => {
            const flashMessages = {{ get_flashed_messages(with_categories=True) | tojson | safe }};

            if (flashMessages.length) {
                const uniqueMessages = [];
                flashMessages.forEach(([category, message]) => {
                    if (!uniqueMessages.includes(message)) {
                        uniqueMessages.push(message);

                        let type;
                        if (category === 'error') type = 'error';
                        else if (category === 'caution') type = 'caution';
                        else type = 'success';

                        showPopup(message, type);
                    }
                });
            }
        });
    </script>
  </body>
</html>
